<!-- Autor: Jonas Hallmann, Patrick Geselbracht -->
<script type="text/javascript">
	function sichern() {
		localStorage.setItem("nachname", document.forms.form.elements.nachname.value);
		localStorage.setItem("vorname", document.forms.form.elements.vorname.value);
		localStorage.setItem("strasse", document.forms.form.elements.strasse.value);
		localStorage.setItem("hausnummer", document.forms.form.elements.hausnummer.value);
		localStorage.setItem("postleitzahl", document.forms.form.elements.postleitzahl.value);
		localStorage.setItem("ort", document.forms.form.elements.ort.value);
		localStorage.setItem("telefon", document.forms.form.elements.telefon.value);
		localStorage.setItem("mobil", document.forms.form.elements.mobil.value);
		localStorage.setItem("email", document.forms.form.elements.email.value);
		localStorage.setItem("nachricht", document.getElementById("nachricht").innerHTML);
	}

	function showMandatoryFieldWarning (field) {
		field.attr("placeholder", "Bitte ausfüllen");
		field.closest("div.form-group").addClass("has-error");
	}

	function pflichtfelder() {
		var mandatoryInputsCompleted = true;

		var mandatoryInputFields = [];
		mandatoryInputFields.push($("#inputSurname"));
		mandatoryInputFields.push($("#inputForename"));
		mandatoryInputFields.push($("#inputEmail"));

		$.each(mandatoryInputFields, function (index, inputField) {
			if(inputField.val() == "") {
				showMandatoryFieldWarning(inputField);
				mandatoryInputsCompleted = false;
			}
		});

		sichern();

		return mandatoryInputsCompleted;
	}
</script>
<div class="container jumbotron">
	<div class="row clearfix">
		<div class="col-md-offset-2 col-md-8 column">
			<div class="ueberschrift">Kontrollformular:</div>
			<h4>Bitte überprüfen Sie Ihre angegebenen Daten!</h4>
			<form role="form" method="post" action="./index.php?inc=vd" onsubmit="return pflichtfelder();" class="form-horizontal">

				<div class="form-group">
					<label for="art" class="col-sm-2 col-md-4 control-label">Art des Anliegens</label>
					<div class="col-sm-10 col-md-8">
						<p class="form-control-static" id="art">Art des Anliegens</p>
						<input id="arthidden" name="art" type="text" hidden>
					</div>
				</div>

				<div class="form-group">
					<label for="inputSurname" class="col-sm-2 col-md-4 control-label">Nachname*</label>
					<div class="col-sm-10 col-md-8">
						<input type="text" class="form-control" id="inputSurname" placeholder="Nachname">
					</div>
				</div>

				<div class="form-group">
					<label for="inputForename" class="col-sm-2 col-md-4 control-label">Vorname*</label>
					<div class="col-sm-10 col-md-8">
						<input type="text" class="form-control" id="inputForename" placeholder="Vorname">
					</div>
				</div>

				<div class="form-group">
					<label for="inputEmail" class="col-sm-2 col-md-4 control-label">E-Mail*</label>
					<div class="col-sm-10 col-md-8">
						<input type="email" class="form-control" id="inputEmail" placeholder="E-Mail">
					</div>
				</div>

				<div class="form-group">
					<label for="inputStreet" class="col-sm-2 col-md-4 control-label">Straße</label>
					<div class="col-sm-10 col-md-8">
						<input type="text" class="form-control" id="inputStreet" placeholder="Straße">
					</div>
				</div>

				<div class="form-group">
					<label for="inputHouseNr" class="col-sm-2 col-md-4 control-label">Hausnr.</label>
					<div class="col-sm-10 col-md-8">
						<input type="text" class="form-control" id="inputHouseNr" placeholder="Hausnummer">
					</div>
				</div>

				<div class="form-group">
					<label for="inputPostalcode" class="col-sm-2 col-md-4 control-label">PLZ</label>
					<div class="col-sm-10 col-md-8">
						<input type="number" class="form-control" id="inputPostalcode" placeholder="Postleitzahl">
					</div>
				</div>

				<div class="form-group">
					<label for="inputLocality" class="col-sm-2 col-md-4 control-label">Ort</label>
					<div class="col-sm-10 col-md-8">
						<input type="text" class="form-control" id="inputLocality" placeholder="Ort">
					</div>
				</div>

				<div class="form-group">
					<label for="inputPhoneNr" class="col-sm-2 col-md-4 control-label">Telefon</label>
					<div class="col-sm-10 col-md-8">
						<input type="tel" class="form-control" id="inputPhoneNr" placeholder="Telefon">
					</div>
				</div>

				<div class="form-group">
					<label for="inputMobileNr" class="col-sm-2 col-md-4 control-label">Mobil</label>
					<div class="col-sm-10 col-md-8">
						<input type="tel" class="form-control" id="inputMobileNr" placeholder="Mobil">
					</div>
				</div>

				<div class="form-group">
					<label for="inputMessage" class="col-sm-2 col-md-4 control-label">Ihre Nachricht</label>
					<div class="col-sm-10 col-md-8">
						<textarea class="form-control" id="inputMessage" rows="3"></textarea>
					</div>
				</div>

				<div class="form-group">
					<label for="art" class="col-sm-2 col-md-4 control-label">Schadensort</label>
					<div class="col-sm-10 col-md-8" id="map">
						<p class="form-control-static" id="schadensort">Schadensort</p>
						<input id="schadensorthidden" type="text" hidden>
					</div>
				</div>

				<div class="form-group">
					<label for="art" class="col-sm-2 col-md-4 control-label">Fotos</label>
					<div class="col-sm-10 col-md-8" id="photos">
					</div>
				</div>

				<input id="koordinatenhidden" type="text" hidden>
				<input id="attachment1" name="attachment1" hidden>
				<input id="anonym" name="anonym" hidden>
				<input name="attachmentCount" value="0" hidden>

				<div class="form-group">
					<div class="col-sm-offset-2 col-md-offset-4 col-sm-10 col-md-8">
						<button type="submit" class="btn btn-primary btn-lg btn-block">Weiter (Anregung jetzt absenden)</button>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(function() {
		$("#art").html(localStorage.getItem("art"));
		$("#art").css("margin-bottom", "0");
		$("#arthidden").val(localStorage.getItem("art"));

		$("#inputSurname").val(localStorage.getItem("nachname"));
		$("#inputForename").val(localStorage.getItem("vorname"));
		$("#inputEmail").val(localStorage.getItem("email"));
		$("#inputStreet").val(localStorage.getItem("strasse"));
		$("#inputHouseNr").val(localStorage.getItem("hausnummer"));
		$("#inputPostalcode").val(localStorage.getItem("postleitzahl"));
		$("#inputLocality").val(localStorage.getItem("ort"));
		$("#inputPhoneNr").val(localStorage.getItem("telefon"));
		$("#inputMobileNr").val(localStorage.getItem("mobil"));

		$("#inputMessage").val(localStorage.getItem("nachricht"));

		$("#schadensort").html(localStorage.getItem("schaden_ort"));
		$("#schadensorthidden").val(localStorage.getItem("schaden_ort"));

		$("#koordinatenhidden").val(localStorage.getItem("latitude") + ", " + localStorage.getItem("longitude"));
		$("#attachment1").val(localStorage.getItem("attachment1"));

		var attachedPhotos = localStorage.getItem("foto").split("data:image");
		if (attachedPhotos.length > 1) {
			for (var photo = 0; photo < attachedPhotos.length; photo++){
				if(photo > 0){
					$("#photos").append("<img src='data:image"+attachedPhotos[photo]+"' class='kontrollePhoto'>");
				}
			}
		} else if (attachedPhotos.length = 1) $("#photos").append("<p class='form-control-static' id='foto'>Keine Fotos vorhanden.</p>");

		if (localStorage.getItem("schaden_ort") != "Dorsten (allgemein)") {
			mapping(localStorage.getItem("latitude"), localStorage.getItem("longitude"));
		}
	});

function mapping(latitude, longitude) {
	$("#map").append("<div id='basicMap' class='kontrolleMapContainer'></div>");
	$("#map").addClass("kontrolleMapdiv");
	map = new OpenLayers.Map("basicMap");
	map.addLayer(new OpenLayers.Layer.OSM());
	var lonLat = new OpenLayers.LonLat(longitude, latitude)
	.transform(
						new OpenLayers.Projection("EPSG:4326"), //transform from WGS 1984
						map.getProjectionObject() //to Spherical Mercator Projection
						);
	map.setCenter(lonLat, 16);
	var markers = new OpenLayers.Layer.Markers("Markers");
	markers.addMarker(new OpenLayers.Marker(lonLat));
	map.addLayer(markers);

	// add #map_attribution so we can change how it looks in CSS w/o overwriting the OpenLayers CSS ID
	$('#OpenLayers_Control_Attribution_7').attr('id','map_attribution');
};
</script>